<div>
	<!-- Nav tabs -->
	<ul class="nav nav-tabs" ng-init="permissionCtrl.active.tab = permissionCtrl.enableTempUseCode? 'home' : permissionCtrl.enableDefaultLogin? 'home2' : null">
		<li ng-if="permissionCtrl.enableTempUseCode" ng-class="{active: permissionCtrl.active.tab == 'home' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('home');" translate="使用許可_使用許可列表">使用許可列表</a></li>
		<li ng-if="permissionCtrl.enableDefaultLogin" ng-class="{active: permissionCtrl.active.tab == 'home2' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('home2');" translate="使用許可_一般帳號狀態">一般帳號狀態</a></li>
		<li ng-if="permissionCtrl.enableTempUseCode" ng-class="{active: permissionCtrl.active.tab == 'search' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('search');" translate="使用許可_重置啟動碼">重置啟動碼</a></li>
		<li ng-if="permissionCtrl.enableTempUseCode" ng-class="{active: permissionCtrl.active.tab == 'create' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('create');" translate="使用許可_建立使用許可">建立使用許可</a></li>
		<li ng-if="permissionCtrl.enableDefaultLogin" ng-class="{active: permissionCtrl.active.tab == 'create2' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('create2');" translate="使用許可_手動建立許可">手動建立許可</a></li>
		<li ng-if="permissionCtrl.enableTempUseCode" ng-class="{active: permissionCtrl.active.tab == 'changes' }"><a style="cursor:pointer" ng-click="permissionCtrl.activeTab('changes');" translate="使用許可_啟動碼變更清單">啟動碼變更清單</a></li>
	</ul>

	<!-- Tab panes -->
	<div class="tab-content">
		<div ng-switch="permissionCtrl.active.tab">
			<div ng-switch-when="home">
				<div style="margin-top: 10px" ng-hide="permissionCtrl.currShow">
					<div>
						<div class="pull-right">
							<label for="search_permission"><i class="fa fa-search"></i></label>
							<input type="text" id="search_permission" placeholder="{{ '使用許可_搜尋使用許可' | translate }}" ng-model="permissionCtrl.search_permission.permission_name" >
						</div>
					</div>
					<table class="table table-striped table-hover table-bordered">
						<tr>
							<th class="text-right" translate="使用許可_使用許可">使用許可</th>
							<th class="text-right" translate="使用許可_已使用人數/總人數">已使用人數/總人數</th>
							<th class="text-right" translate="使用許可_老師數量">老師數量</th>
							<th class="text-right" translate="使用許可_老師許可期限">老師許可期限(天)</th>
							<th class="text-right" translate="使用許可_學生數量">學生數量</th>
							<th class="text-right" translate="使用許可_學生許可期限">學生許可期限(天)</th>
						</tr>
						<tr ng-repeat="item in permissionCtrl.permissions | filter:permissionCtrl.search_permission">
							<td class="text-right">
								<a href="javascript:;" class="code" ng-click="permissionCtrl.currShow = true; permissionCtrl.getContent(item)">{{item.permission_name}}</a>
							</td>
							<td colspan="5" ng-if="item.error_msg">{{ item.error_msg | translate }}</td>
							<td class="text-right" ng-if="!item.error_msg">
								{{item.used_count}}/{{item.teacher_count + item.student_count}}
							</td>
							<td class="text-right" ng-if="!item.error_msg">{{item.teacher_count}}</td>
							<td class="text-right" ng-if="!item.error_msg">{{item.teacher_duration}}</td>
							<td class="text-right" ng-if="!item.error_msg">{{item.student_count}}</td>
							<td class="text-right" ng-if="!item.error_msg">{{item.student_duration}}</td>
						</tr>
					</table>
				</div>
				<div class="panel panel-primary" style="margin-top: 10px" ng-show="permissionCtrl.currShow">
					<div class="panel-heading">
						<a class="btn btn-primary btn-sm pull-right" style="border:none;margin:-5px 0" ng-click="permissionCtrl.currShow = false">
							<i class="fa fa-fw fa-times"></i>
						</a>
						<h3 class="panel-title">
							<span translate="使用許可_使用許可檔案">使用許可檔案</span>: <span class="code">{{ permissionCtrl.curr.permission_name }}</span>
						</h3>
					</div>
					<div class="panel-body">
						<div>
							<span translate="使用許可_下載">下載</span>:
							<a href="/private/sys/permission/export/{{ permissionCtrl.curr.permission_name }}.csv">CSV</a> |
							<a href="/private/sys/permission/export/{{ permissionCtrl.curr.permission_name }}.xls">Excel</a>
							<div class="pull-right">
								<label for="search_account_code"><i class="fa fa-search"></i></label>
								<input type="text" id="search_account_code" placeholder="{{ '使用許可_關鍵字搜尋' | translate }}" ng-model="permissionCtrl.search_account_code">
							</div>
						</div>
						<table class="table table-striped table-hover table-bordered">
							<tr>
								<th translate="使用許可_啟動碼">啟動碼</th>
								<th translate="使用許可_角色">角色</th>
								<th translate="使用許可_帳號">帳號</th>
								<th translate="使用許可_啟動時間">啟動時間</th>
								<th class="text-right" translate="使用許可_許可期限">許可期限(天)</th>
							</tr>
							<tr ng-repeat="item in permissionCtrl.curr.account_codes | filter:permissionCtrl.search_account_code">
								<td class="code">{{ item.code }}</td>
								<td>{{ item.role }}</td>
								<td>{{ item.userid || '使用許可_未使用' | translate }}</td>
								<td>{{ item.activation_time | date : 'yyyy-MM-dd HH:mm' }}</td>
								<td class="text-right">{{ item.duration }}</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			<div ng-switch-when="home2" ng-init="permissionCtrl.home2.selectedImportPermssion=[]">
				<div style="margin-top: 10px">
					<div>
						<label for="show_account_total"><i class="fa fa-user" aria-hidden="true"></i></label>
						<input type="hidden" id="show_account_total" style="width: 3em;" ng-model="home2AccountTotal" disabled>
						<label for="show_account_total">{{home2AccountTotal}} / {{home2AccountMax}}</label>
						<div class="pull-right clearfix">
							<label for="search_importPermission"><i class="fa fa-search"></i></label>
							<input type="text" id="search_importPermission" placeholder="{{ '使用許可_搜尋匯入帳號' | translate }}" ng-model="permissionCtrl.search_importPermission.keyword" >
						</div>
					</div>
					<table class="table table-striped table-hover table-bordered">
						<tr>
							<th class="text-right" translate="使用許可_使用者編號">使用者編號</th>
							<th class="text-right" translate="使用許可_使用者帳號">使用者帳號</th>
							<th class="text-right" translate="使用許可_使用者姓名">使用者姓名</th>
							<th class="text-right" translate="使用許可_最後登入時間">最後登入時間</th>
							<th class="text-right" translate="使用許可_使用許可期限">使用許可期限</th>
							<th class="text-right" translate="使用許可_選取使用者">選取使用者</th>
						</tr>
						<tr ng-repeat="item in permissionCtrl.i_permissions | filter:permissionCtrl.search_importPermission.keyword">
							<td class="text-right">{{item.uqid}}</td>
							<td class="text-right">{{item.userid.split('@')[0]}}</td>
							<td class="text-right">{{item.last_name + item.first_name}}</td>
							<td class="text-right">{{item.last_login_time | date : 'yyyy-MM-dd HH:mm' }}</td>
							<td class="text-right">
								{{ (!item.expired_date || permissionCtrl.disableAccount(item.expired_date))? ('使用許可_帳號失效' | translate) : (item.expired_date | date : 'yyyy-MM-dd HH:mm') }}
							</td>
							<td class="text-center">
								<input type="checkbox" ng-model="permissionCtrl.home2.selectedImportPermssion[$index]" ng-true-value="{{item.id}}" ng-false-value="{{undefined}}">
							</td>
						</tr>
					</table>
					<div ng-if="!!(permissionCtrl.home2.selectedImportPermssion).length" ng-init="permissionCtrl.home2.selectedSetting=false" class="pull-right clearfix" style="text-align: right; margin-top: 10px;">
						<button type="button" class="btn {{permissionCtrl.home2.selectedSetting? 'btn-success' : 'btn-danger'}} pull-left" ng-click="permissionCtrl.home2.selectedSetting = !permissionCtrl.home2.selectedSetting">
							<span ng-show="permissionCtrl.home2.selectedSetting"> {{ '使用許可_選定啟用' | translate }}</span>
							<span ng-hide="permissionCtrl.home2.selectedSetting"> {{ '使用許可_選定失效' | translate }}</span>
						</button>
						
						<div ng-show="permissionCtrl.home2.selectedSetting" class="pull-left" style="margin-left: 10px; padding: 4px;">
							<label for="selectedSetting"><i class="fa fa-clock-o"></i></label>
							<input type="number" placeholder="{{ '使用許可_延時設定' | translate }}" ng-model="permissionCtrl.home2.setDate">
						</div>
						<button type="button" class="btn btn-primary" style="margin-left: 10px;" translate="使用許可_儲存" ng-click="permissionCtrl.saveUserChange()" ng-disabled="permissionCtrl.home2.saveBtnDisabled">儲存</button>
					</div>
				</div>
			</div>
			<div ng-switch-when="search">
				<div style="margin-top: 10px;">
					<form class="form-inline" ng-submit="permissionCtrl.searchCode()">
						<div class="form-group">
							<label for="searchCode" translate="使用許可_查詢啟動碼">查詢啟動碼</label>
							<input type="text" id="searchCode" class="form-control" placeholder="{{ '使用許可_啟動碼' | translate }}" required ng-model="permissionCtrl.search_code">
						</div>
						<button type="submit" class="btn btn-primary" translate="使用許可_查詢">查詢</button>
					</form>
				</div>
				<div class="panel panel-primary" style="margin-top: 10px" ng-show="permissionCtrl.search.code">
					<div class="panel-heading">
						<h3 class="panel-title">
							<span translate="使用許可_查詢啟動碼">查詢啟動碼</span>:
							<span class="code">{{ permissionCtrl.search.code }}</span>
						</h3>
					</div>
					<div class="panel-body">
						<table class="table table-striped table-hover table-bordered">
							<tr>
								<th class="text-center" translate="使用許可_帳號重置">帳號 / 重置</th>
								<th class="text-right" translate="使用許可_啟動碼">啟動碼</th>
								<th class="text-right" translate="使用許可_使用許可">使用許可</th>
								<th class="text-right" translate="使用許可_角色">角色</th>
								<th class="text-right" translate="使用許可_啟動時間">啟動時間</th>
								<th class="text-right" translate="使用許可_許可期限">許可期限</th>
							</tr>
							<tr ng-repeat="item in permissionCtrl.search.account_codes">
								<td class="text-center">
									<a href="javascript:;" ng-if="!item.userid" ng-click="permissionCtrl.resetCode(item)" translate="使用許可_重置">重置</a>
									<span ng-if="item.userid">{{ item.userid }}</span>
								</td>
								<td class="text-right">
									<span class="code">{{ item.code }}</span>
									<span class="code" ng-show="item.new_code"> => {{ item.new_code }}</span>
								</td>
								<td class="text-right code">{{ item.permission_name }}</td>
								<td class="text-right">{{ item.role }}</td>
								<td class="text-right">{{ item.activation_time | date : 'yyyy-MM-dd HH:mm' }}</td>
								<td class="text-right">{{ item.duration }}</td>
							</tr>
							<tr ng-show="permissionCtrl.search.account_codes.length==0">
							  <td colspan="6" translate="使用許可_沒有資料">沒有資料</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			<div ng-switch-when="create">
				<div style="margin-top: 10px;" ng-if="permissionCtrl.create.layout=='upload'">
					<form class="form-inline" id="myForm" ng-submit="permissionCtrl.uploadPermission()">
						<div class="form-group">
							<label for="permissionFile" translate="使用許可_上傳許可檔">上傳許可檔(.cbp)</label>
							<input type="file" id="permissionFile" class="form-control" accept=".cbp" required>
						</div>
						<button type="submit" class="btn btn-primary" translate="使用許可_上傳" ng-disabled="permissionCtrl.create.uploadBtnDisabled">上傳</button>
					</form>
				</div>

				<div class="panel panel-primary" style="margin-top: 10px" ng-if="permissionCtrl.create.layout=='checked'">
					<div class="panel-heading">
						<a class="btn btn-primary btn-sm pull-right" style="border:none;margin:-5px 0" ng-click="permissionCtrl.create.layout='upload'">
							<i class="fa fa-fw fa-times"></i>
						</a>
						<h3 class="panel-title">
							<span class="ng-binding">{{ '使用許可_許可檔' | translate }}: {{ permissionCtrl.create.info.filename }}</span>
						</h3>
					</div>
					<div class="panel-body">
						<div>
							<ul class="list-group">
								<li class="list-group-item"><strong translate="使用許可_使用許可">使用許可</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.contract_no || "--" }}</span></li>
								<li class="list-group-item"><strong translate="使用許可_老師數量">老師數量</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.teacher_count || "--" }}</span></li>
								<li class="list-group-item"><strong translate="使用許可_老師許可期限">老師許可期限(天)</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.teaacher_duration || "--" }}</span></li>
								<li class="list-group-item"><strong translate="使用許可_學生數量">使用許可_學生數量</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.student_count || "--" }}</span></li>
								<li class="list-group-item"><strong translate="使用許可_學生許可期限">學生許可期限(天)</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.student_duration || "--" }}</span></li>
								<li class="list-group-item" ng-class="{true: 'list-group-item-success', false: 'list-group-item-danger'}[permissionCtrl.create.info.never_used]"><strong translate="使用許可_未曾建立">未曾建立</strong><strong>:</strong> <span>{{ permissionCtrl.create.info.never_used }}</span></li>
							</ul>
						</div>
					</div>
					<div class="panel-footer" style="text-align:right" ng-if="permissionCtrl.create.info.never_used">
						<button type="button" class="btn btn-primary" translate="使用許可_建立" ng-click="permissionCtrl.createCode()" ng-disabled="permissionCtrl.create.createBtnDisabled">建立</button>
					</div>
				</div>
			</div>
			<div ng-switch-when="create2">
				<div style="margin-top: 10px;" ng-if="permissionCtrl.create2.layout=='upload'">
					<form class="form-inline" id="myForm" ng-submit="permissionCtrl.importPermission()">
						<div class="form-group">
							<label for="importFile" translate="使用許可_上傳批次檔">上傳批次檔(.csv)</label>
							<input type="file" id="importFile" class="form-control" accept=".csv" required>
						</div>
						<button type="submit" class="btn btn-primary" translate="使用許可_上傳" ng-disabled="permissionCtrl.create2.uploadBtnDisabled">上傳</button>
						<a type="button" href="{{permissionCtrl.create2.example}}" class="btn btn-info" translate="使用許可_範例檔案">範例檔案</a>
					</form>
					<div class="row" style="margin-top: 10px;border-radius: 2px;border: 1px solid #CCC">
						<div class="col-md-3" style="margin-top: 10px">
							<h4 translate="使用許可_範例說明">範例說明</h4>
							<p translate="使用許可_範例說明1">1.第一列為各欄位說明</p>
							<p translate="使用許可_範例說明2">2.第二列為新增範例</p>
							<p translate="使用許可_範例說明3">3.每列第一欄為編號，若輸入「#」則不理會該列(如表黃色)</p>
							<p translate="使用許可_範例說明4">4.請用csv格式存檔，utf8編碼</p>
							<p translate="使用許可_範例說明5">5.上傳完畢後系統將會過濾資料，請檢查底色為紅色的資料</p>
							<p translate="使用許可_範例說明6">6.若匯入紅色資料則會<strong>導致該帳號重新覆寫</strong>，請注意!</p>
						</div>
						<div class="col-md-9">
							<table class="table table-bordered">
								<caption translate="使用許可_範例示意表">範例示意表</caption>
								<thead>
									<tr>
										<th translate="使用許可_範例編號">編號</th>
										<th translate="使用許可_範例帳號">帳號</th>
										<th translate="使用許可_範例密碼">密碼</th>
										<th translate="使用許可_範例名字">名字</th>
										<th translate="使用許可_範例姓氏">姓氏</th>
										<th translate="使用許可_範例時間">有效時間(天)</th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="x in c2example" ng-class="{'warning' : x.id=='#'}">
										<td>{{ x.id }}</td><td>{{ x.u }}</td><td>{{ x.p }}</td><td>{{ x.f }}</td><td>{{ x.l }}</td><td>{{ x.d }}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

                <div class="panel panel-primary" style="margin-top: 10px" ng-if="permissionCtrl.create2.layout=='checked'">
                    <div class="panel-heading">
                        <a class="btn btn-primary btn-sm pull-right" style="border: none; margin: -5px 0" ng-click="permissionCtrl.create2.layout='upload'">
                            <i class="fa fa-fw fa-times"></i>
                        </a>
                        <h3 class="panel-title">
                            <span class="ng-binding">{{ '使用許可_批次檔' | translate }}: {{ permissionCtrl.create2.info.filename }}</span>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <div>
                            <table class="table" show-filter="true">
                                <caption translate="使用許可_批次檔過濾結果">批次檔過濾結果</caption>
                                <thead>
                                    <tr>
                                        <th translate="使用許可_批次檔過濾帳號">批次檔過濾帳號</th>
                                        <th translate="使用許可_批次檔過濾密碼">批次檔過濾密碼</th>
                                        <th translate="使用許可_批次檔過濾姓氏">批次檔過濾姓氏</th>
                                        <th translate="使用許可_批次檔過濾名字">批次檔過濾名字</th>
                                        <th translate="使用許可_批次檔過濾期限">批次檔過濾期限</th>
                                    </tr>
                                </thead>
                                <tbody >
                                    <tr ng-repeat="user in permissionCtrl.create2.info.deny" class="danger">
                                        <td title="Account" filter="{ acc: 'text'}">{{user.acc}}</td>
                                        <td title="Password" filter="{ pwd: 'text'}">{{user.pwd}}</td>
                                        <td title="FirstName" filter="{ first_name: 'text'}">{{user.first_name}}</td>
                                        <td title="LastName" filter="{ last_name: 'text'}">{{user.last_name}}</td>
                                        <td title="Duration" filter="{ duration: 'text'}">{{user.duration}}</td>
                                    </tr>
                                </tbody>
                                <tbody>
                                    <tr ng-repeat="user in permissionCtrl.create2.info.view">
                                        <td title="Account" filter="{ acc: 'text'}">{{user.acc}}</td>
                                        <td title="Password" filter="{ pwd: 'text'}">{{user.pwd}}</td>
                                        <td title="FirstName" filter="{ first_name: 'text'}">{{user.first_name}}</td>
                                        <td title="LastName" filter="{ last_name: 'text'}">{{user.last_name}}</td>
                                        <td title="Duration" filter="{ duration: 'text'}">{{user.duration}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p ng-if="permissionCtrl.create2.info.deny.length != 0" class="mark" translate="使用許可_批次檔匯入說明">批次檔匯入說明</p>
                    </div>
                    <div class="panel-footer" style="text-align:right" ng-if="permissionCtrl.create2.info.filename && permissionCtrl.create2.info.deny.length == 0">
                        <button type="button" class="btn btn-primary" translate="使用許可_建立" ng-click="permissionCtrl.createImport()" ng-disabled="permissionCtrl.create2.createBtnDisabled">建立</button>
                    </div>
                </div>
			</div>
			<div ng-switch-when="changes">
				<div style="margin-top: 10px;">
					<div>
						<div class="pull-right">
							<label for="search_changeCode"><i class="fa fa-search"></i></label>
							<input type="text" id="search_changeCode" placeholder="{{ '使用許可_關鍵字搜尋' | translate }}" ng-model="search_changeCode">
						</div>
					</div>
					<table class="table table-striped table-hover table-bordered">
						<tbody>
							<tr>
								<th class="text-center" translate="使用許可_變更前啟動碼">變更前啟動碼</th>
								<th class="text-center" translate="使用許可_變更後啟動碼">變更後啟動碼</th>
								<th class="text-center" translate="使用許可_使用許可">使用許可</th>
								<th class="text-center" translate="使用許可_角色">角色</th>
								<th class="text-center" translate="使用許可_變更時間">變更時間</th>
							</tr>
							<tr ng-repeat="item in permissionCtrl.changes | filter: search_changeCode">
								<td class="text-center code">{{ item.old_code }}</td>
								<td class="text-center code">{{ item.new_code }}</td>
								<td class="text-center code">{{ item.permission_name }}</td>
								<td class="text-center">{{ item.role }}</td>
								<td class="text-center">{{ item.updated_at | date : 'yyyy-MM-dd HH:mm' }}</td>
							</tr>
							<tr ng-show="permissionCtrl.changes.length==0">
							  <td colspan="5" translate="使用許可_沒有資料">沒有資料</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="errorMessageModal" class="modal fade" style="z-index:1480">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-body">
				<h4 class="text-danger" translate="{{permissionCtrl.errMessage}}"></h4>
			</div>
		</div>
	</div>
</div>